# HTTP 요약 2

## HTTP API를 설계해볼까?

### URI를 설계할 때는 최대한 리소스로만 구성해라.
    보통 리소스(명사)로 URI를 설계하고 리소스에 대한 행위는 HTTP 메서드로 해결한다.
    하지만 HTTP 메서드로 딱 떨어지지 않는 행위는 어떻게 할까..?
    그럴땐 어쩔수 없이 컨트롤러 URI(행위:동사)가 쓰인다.
    
### GET 메서드
    리소스를 조회할 때 쓰는 메서드
    서버에 전달하고 싶은 데이터가 있다? => 쿼리 파라미터를 이용한다.
    (하지만 요즘 스펙은 메세지 바디에 데이터를 넣을 수 있다지만, 지원 안하는 서버도 종종 있기에 권장은 아님)
    
### POST 메서드
    요청 데이터를 처리해달라고 할 때 쓰는 메서드
    메시지 바디에 데이터가 들어가 있고, 새 리소스를 등록할 때 보통 쓰인다. 혹은 프로세스를 실행할 때
    
### PUT 메서드
    요청 데이터(리소스)로 해당 리소스를 대체한다.
    클라이언트가 리소스의 경로를 알고있으며, 경로에 리소스가 없으면 생성, 있으면 덮어쓰기
    PUT도 POST와 같이 등록에 이용될 수 있지만 차이는 POST는 보통 리소스의 경로를 모른다.
    
### PATCH 메서드
    리소스의 일부를 변경한다.
    만약 접근하는 리소스의 일부 필드를 변경하고 싶을 때
    근데 아주 드물게 지원 안 하는 서버가 있을 때도 있는데, 그럴땐 POST 쓰자.
    
### DELETE 메서드
    리소스를 삭제한다.
    
## 여기까지가 많이 쓰이는 메서드들 이고, 속성(특징)을 알아보자.

### 1. 안전
    안전이란, 요청을 할 때 리소스의 변경이 없는가..? 이거다.
    GET은 안전하다. 왜냐면, 리소스를 그저 조회만 하니까 변경될 일이 없다.
    
### 2. 멱등
    멱등이란, 같은 요청을 한번, 10번, 100번 똑같이 요청해도, 응답 결과가 같은가..? 이다.
    GET은 여러번 요청해도 같은 리소스를 접근하므로 결과가 같다.
    PUT은 리소스의 경로에 데이터를 덮어쓰기 해버린다. 그리고 여러번해도 항상 덮어쓰기를 해서 항상 같은 결과이다.
    DELETE도 여러번 해도 어차피 처음에 삭제가 되었을거고, 결과는 항상 삭제이므로 같다.
    POST는 멱등하지않다. 좋은 이유로는 POST는 프로세스를 처리할 때 쓰는 메서드이기도 한데,
    만약 결제 프로세스라면, 여러번 호출하면 결제가 여러번 되버린다. 같은 결과가 나오기 쉽지않다.
    
### 2-1. 근데 그래서 멱등이 뭐가 중요해?
    멱등이란 개념은 뭔가.. 자동복구시스템? 이런거 설계하기 좋은 개념인거같다.
    만약 요청을 했는데 서버에서 제대로 응답이 안되는거같다. 그러면 자체적으로 한번 더 요청을 날리게 할 수 있다.
    그때 멱등이면, 여러번 요청이 가도 결과는 같다. 이런 개념인거 같다.
    예를 들면 DELETE 메서드라면, 한번 더 요청이 가도, 결과는 같다.
    
### 3. 캐시가능
    보통 캐시는 GET에서 많이 쓰인다고한다.
    캐시란 키:밸류 느낌으로 저장해놓는건데, GET은 리소스 URI를 캐시한다고 하면, 깔끔하다.
    근데 POST, PUT, PATCH 이런거는 URI 뿐만 아니라 메시지 바디까지 캐시를 해야하는데 쉽지 않다고 한다.
    사실상 캐시는 DELETE 빼곤 다 가능한데, GET만 쓰인다.
    
## 자, 클라이언트에서 서버로 데이터를 전송해보자.

### 데이터 전달 방식은 크게 2가지가 있다.

### 1. 쿼리 파라미터로 전달
    보통 GET에서 많이 사용한다.
    예를 들면 정렬필터(검색조건) 등에 쓰인다.
    
### 2. 메시지 바디로 전달
    보통 POST, PUT, PATCH에서 쓰인다.
    
### 여기서 HTML Form으로 데이터를 서버로 전달한다면?
    보통은 메서드가 POST인데, GET도 조회할 때는 쓸 수 있다.
    POST는 서버로 전달될 때 요청 메시지가 Centent-Type: application/xxx/urlencoded 요런 느낌으로 헤더가 생성되고,
    메시지바디에 쿼리파라미터와 똑같이 생긴 데이터가 담겨서 전송된다.
    만약 GET 메서드로 바뀌면, 메시지 바디에 있던게 쿼리파라미터로 올라올것이다.
    
    파일 전송이라면, enctype: multipart-formdata 느낌으로 Content-Type이 설정되고,
    바운더리로 인해 파트별로 나뉘어져 값들이 넘어간다.
    
### URI 설계 할 때
    POST기반이면, 서버가 리소스의 URL을 설정하고 관리하므로 COLLECION 스타일이라고 부르고,
    PUT기반이면, 클라이언트가 리소스의 URL을 알고, 관리하므로 STORE 스타일이라고 한단다.
    보통 COLLECTION 스타일로 하되, 파일관련은 STORE을 쓸 때도 있다고 한다.
